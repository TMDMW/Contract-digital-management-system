# æƒé™ç®¡ç†ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ¯ æƒé™ç®¡ç†åŠŸèƒ½æ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†åŸºäºè§’è‰²å’Œéƒ¨é—¨çš„æƒé™ç®¡ç†ï¼Œæ”¯æŒä»¥ä¸‹åŠŸèƒ½ï¼š

### è§’è‰²ç±»å‹
- **ç®¡ç†å‘˜ (admin)** - æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œå¯ä»¥ç®¡ç†ç”¨æˆ·ã€éƒ¨é—¨å’Œæ‰€æœ‰åˆåŒ
- **ç»ç† (manager)** - éƒ¨é—¨ç®¡ç†æƒé™ï¼Œå¯ä»¥ç®¡ç†æœ¬éƒ¨é—¨ç›¸å…³åˆåŒ
- **æ™®é€šç”¨æˆ· (user)** - åŸºç¡€æƒé™ï¼Œåªèƒ½ç®¡ç†è‡ªå·±åˆ›å»ºçš„åˆåŒ

### éƒ¨é—¨æƒé™ç±»å‹
- **åªè¯» (read)** - å¯ä»¥æŸ¥çœ‹è¯¥éƒ¨é—¨çš„åˆåŒ
- **è¯»å†™ (write)** - å¯ä»¥æŸ¥çœ‹å’Œç¼–è¾‘è¯¥éƒ¨é—¨çš„åˆåŒ
- **ç®¡ç† (admin)** - å¯ä»¥ç®¡ç†è¯¥éƒ¨é—¨çš„æ‰€æœ‰åˆåŒï¼ˆåŒ…æ‹¬åˆ é™¤ï¼‰

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

### æ–°å¢è¡¨ç»“æ„

#### 1. departments (éƒ¨é—¨è¡¨)
```sql
CREATE TABLE departments (
  id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(100) NOT NULL UNIQUE,
  description TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 2. user_department_permissions (ç”¨æˆ·éƒ¨é—¨æƒé™è¡¨)
```sql
CREATE TABLE user_department_permissions (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL,
  department_id INT NOT NULL,
  permission_type ENUM('read', 'write', 'admin') DEFAULT 'read',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (department_id) REFERENCES departments(id) ON DELETE CASCADE,
  UNIQUE KEY unique_user_department (user_id, department_id)
);
```

#### 3. usersè¡¨æ–°å¢å­—æ®µ
```sql
ALTER TABLE users ADD COLUMN role ENUM('admin', 'manager', 'user') DEFAULT 'user' AFTER department;
```

## ğŸš€ å®‰è£…å’Œé…ç½®

### 1. æ•°æ®åº“è¿ç§»
è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ›´æ–°æ•°æ®åº“ç»“æ„ï¼š

```bash
mysql -h localhost -u ht -p contract_management < database/migrate.sql
```

### 2. é‡å¯æœåŠ¡
```bash
# é‡å¯åç«¯æœåŠ¡
cd backend
npm start

# é‡å¯å‰ç«¯æœåŠ¡
cd frontend
npm run serve
```

## ğŸ‘¥ ç”¨æˆ·ç®¡ç†

### ç®¡ç†å‘˜åŠŸèƒ½
1. **ç”¨æˆ·ç®¡ç†** - å·¦ä¾§èœå• â†’ ç”¨æˆ·ç®¡ç†
   - æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
   - åˆ›å»ºæ–°ç”¨æˆ·å¹¶è®¾ç½®è§’è‰²
   - ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯å’Œè§’è‰²
   - åˆ é™¤ç”¨æˆ·ï¼ˆä¿æŠ¤adminç”¨æˆ·ï¼‰

2. **æƒé™ç®¡ç†** - å·¦ä¾§èœå• â†’ æƒé™ç®¡ç†
   - ç”¨æˆ·æƒé™ç®¡ç†ï¼šä¸ºç”¨æˆ·åˆ†é…éƒ¨é—¨è®¿é—®æƒé™
   - éƒ¨é—¨ç®¡ç†ï¼šåˆ›å»ºå’Œç®¡ç†éƒ¨é—¨

### æƒé™åˆ†é…æµç¨‹
1. è¿›å…¥æƒé™ç®¡ç†é¡µé¢
2. é€‰æ‹©"ç”¨æˆ·æƒé™ç®¡ç†"æ ‡ç­¾
3. ç‚¹å‡»ç”¨æˆ·çš„"ç¼–è¾‘æƒé™"æŒ‰é’®
4. ä¸ºç”¨æˆ·åˆ†é…ä¸åŒéƒ¨é—¨çš„è®¿é—®æƒé™
5. ä¿å­˜æƒé™è®¾ç½®

## ğŸ“„ åˆåŒè®¿é—®æ§åˆ¶

### è®¿é—®è§„åˆ™
1. **ç®¡ç†å‘˜** - å¯ä»¥æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰åˆåŒ
2. **åˆåŒåˆ›å»ºè€…** - å¯ä»¥æŸ¥çœ‹å’Œç®¡ç†è‡ªå·±åˆ›å»ºçš„åˆåŒ
3. **åŒéƒ¨é—¨ç”¨æˆ·** - å¯ä»¥æŸ¥çœ‹åŒéƒ¨é—¨å…¶ä»–ç”¨æˆ·åˆ›å»ºçš„åˆåŒ
4. **æœ‰æƒé™çš„ç”¨æˆ·** - å¯ä»¥æ ¹æ®åˆ†é…çš„éƒ¨é—¨æƒé™è®¿é—®ç›¸åº”åˆåŒ

### æ“ä½œæƒé™
- **æŸ¥çœ‹åˆåŒ** - æ ¹æ®è®¿é—®è§„åˆ™ç¡®å®š
- **ä¸‹è½½åˆåŒ** - ä¸æŸ¥çœ‹æƒé™ç›¸åŒ
- **åˆ é™¤åˆåŒ** - ä»…é™ç®¡ç†å‘˜å’ŒåˆåŒåˆ›å»ºè€…

## ğŸ”§ APIæ¥å£

### æƒé™ç®¡ç†API

#### éƒ¨é—¨ç®¡ç†
- `GET /api/permissions/departments` - è·å–æ‰€æœ‰éƒ¨é—¨
- `POST /api/permissions/departments` - åˆ›å»ºéƒ¨é—¨ï¼ˆä»…ç®¡ç†å‘˜ï¼‰

#### ç”¨æˆ·æƒé™ç®¡ç†
- `GET /api/permissions/user-permissions/:userId` - è·å–ç”¨æˆ·æƒé™ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
- `POST /api/permissions/user-permissions` - è®¾ç½®ç”¨æˆ·æƒé™ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
- `DELETE /api/permissions/user-permissions/:userId/:departmentId` - åˆ é™¤ç”¨æˆ·æƒé™ï¼ˆä»…ç®¡ç†å‘˜ï¼‰

#### æƒé™æ£€æŸ¥
- `GET /api/permissions/my-departments` - è·å–å½“å‰ç”¨æˆ·å¯è®¿é—®çš„éƒ¨é—¨
- `GET /api/permissions/check-permission/:departmentId` - æ£€æŸ¥å¯¹ç‰¹å®šéƒ¨é—¨çš„æƒé™

## ğŸ¨ å‰ç«¯ç•Œé¢

### æ–°å¢é¡µé¢
1. **æƒé™ç®¡ç†é¡µé¢** (`/permissions`)
   - ç”¨æˆ·æƒé™ç®¡ç†æ ‡ç­¾
   - éƒ¨é—¨ç®¡ç†æ ‡ç­¾

### ç•Œé¢æ”¹è¿›
1. **åˆåŒåˆ—è¡¨** - æ˜¾ç¤ºåˆ›å»ºè€…å’Œæ‰€å±éƒ¨é—¨ä¿¡æ¯
2. **ç”¨æˆ·ç®¡ç†** - æ·»åŠ è§’è‰²ç®¡ç†åŠŸèƒ½
3. **èœå•æ§åˆ¶** - æ ¹æ®ç”¨æˆ·è§’è‰²æ˜¾ç¤ºä¸åŒèœå•é¡¹

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯1ï¼šä¸ºé”€å”®äººå‘˜åˆ†é…æƒé™
1. ç®¡ç†å‘˜ç™»å½•ç³»ç»Ÿ
2. è¿›å…¥æƒé™ç®¡ç† â†’ ç”¨æˆ·æƒé™ç®¡ç†
3. æ‰¾åˆ°é”€å”®äººå‘˜ï¼Œç‚¹å‡»"ç¼–è¾‘æƒé™"
4. ä¸ºå…¶åˆ†é…"é”€å”®éƒ¨"çš„"è¯»å†™"æƒé™
5. ä¿å­˜è®¾ç½®

### åœºæ™¯2ï¼šæŸ¥çœ‹è·¨éƒ¨é—¨åˆåŒ
1. ç”¨æˆ·ç™»å½•ç³»ç»Ÿ
2. è¿›å…¥åˆåŒç®¡ç†é¡µé¢
3. å¯ä»¥çœ‹åˆ°ï¼š
   - è‡ªå·±åˆ›å»ºçš„åˆåŒ
   - åŒéƒ¨é—¨åŒäº‹çš„åˆåŒ
   - æœ‰æƒé™è®¿é—®çš„å…¶ä»–éƒ¨é—¨åˆåŒ

## ğŸ”’ å®‰å…¨ç‰¹æ€§

1. **è§’è‰²éªŒè¯** - æ‰€æœ‰ç®¡ç†åŠŸèƒ½éƒ½éœ€è¦ç®¡ç†å‘˜æƒé™
2. **æƒé™æ£€æŸ¥** - åˆåŒè®¿é—®å‰è¿›è¡Œæƒé™éªŒè¯
3. **æ•°æ®éš”ç¦»** - ç”¨æˆ·åªèƒ½çœ‹åˆ°æœ‰æƒé™çš„æ•°æ®
4. **æ“ä½œæ—¥å¿—** - é‡è¦æ“ä½œéƒ½æœ‰æ—¥å¿—è®°å½•

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æƒé™ç®¡ç†é¡µé¢æ˜¾ç¤ºç©ºç™½**
A: ç¡®ä¿ç”¨æˆ·å…·æœ‰ç®¡ç†å‘˜æƒé™ï¼Œæ™®é€šç”¨æˆ·æ— æ³•è®¿é—®æƒé™ç®¡ç†

**Q: ç”¨æˆ·çœ‹ä¸åˆ°å…¶ä»–éƒ¨é—¨çš„åˆåŒ**
A: æ£€æŸ¥ç”¨æˆ·æ˜¯å¦è¢«åˆ†é…äº†ç›¸åº”éƒ¨é—¨çš„è®¿é—®æƒé™

**Q: æ•°æ®åº“è¿ç§»å¤±è´¥**
A: ç¡®ä¿æ•°æ®åº“è¿æ¥æ­£å¸¸ï¼Œå¹¶ä¸”æœ‰è¶³å¤Ÿçš„æƒé™æ‰§è¡ŒDDLè¯­å¥

### è°ƒè¯•æ­¥éª¤
1. æ£€æŸ¥ç”¨æˆ·è§’è‰²ï¼š`SELECT role FROM users WHERE username = 'your_username'`
2. æ£€æŸ¥ç”¨æˆ·æƒé™ï¼š`SELECT * FROM user_department_permissions WHERE user_id = your_user_id`
3. æ£€æŸ¥éƒ¨é—¨æ•°æ®ï¼š`SELECT * FROM departments`

## ğŸ”„ å‡çº§è¯´æ˜

å¦‚æœä»æ—§ç‰ˆæœ¬å‡çº§ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. å¤‡ä»½ç°æœ‰æ•°æ®åº“
2. è¿è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬
3. é‡å¯åç«¯æœåŠ¡
4. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
5. é‡æ–°ç™»å½•ç³»ç»Ÿ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
2. åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨
3. å‰ç«¯æ˜¯å¦æ­£ç¡®è¿æ¥åˆ°åç«¯API
4. ç”¨æˆ·æƒé™æ˜¯å¦æ­£ç¡®é…ç½®